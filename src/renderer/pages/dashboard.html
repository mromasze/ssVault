<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!--        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;">-->
    <title>Dashboard - Password Manager</title>
    <link href="../vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../vendors/tailwind/tailwindcss.js"></script>
    <script>
        tailwind.config = {
            corePlugins: {
                preflight: false,
            }
        }
    </script>
</head>
<body>
<div class="container-fluid mt-4 px-4">
    <ul class="nav nav-tabs" id="dashboardTabs">
        <li class="nav-item"><a class="nav-link active" href="#home" data-bs-toggle="tab"><i class="bi bi-house-door"></i> Home</a></li>
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="passwordsDropdown" data-bs-toggle="dropdown" role="button" aria-expanded="false"><i class="bi bi-key"></i> Passwords</a>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item nav-link" href="#passwords" data-bs-toggle="tab">Passwords</a></li>
                <li><a class="dropdown-item nav-link" href="#groups" data-bs-toggle="tab">Groups</a></li>
            </ul>
        </li>
        <li class="nav-item"><a class="nav-link" href="#files" data-bs-toggle="tab"><i class="bi bi-folder"></i> Files</a></li>
        <li class="nav-item"><a class="nav-link" href="#gpg" data-bs-toggle="tab"><i class="bi bi-shield-lock"></i> GPG Keys</a></li>
    </ul>
    <div class="position-absolute top-0 end-0 mt-4 me-4">
        <button class="btn btn-outline-secondary" id="settingsBtn" title="Settings">
            <i class="bi bi-gear"></i>
        </button>
    </div>
    <div class="tab-content mt-3">
        <div class="tab-pane active" id="home">
            <div class="mb-4">
                <h2 class="mb-1">Welcome in vault <span id="vaultName" class="text-primary"></span></h2>
                <small class="text-muted">Quick overview of your vault contents</small>
            </div>
            <div class="row g-3" id="summaryRow">
                <div class="col-12 col-sm-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <div class="mx-auto mb-2 rounded-circle d-flex align-items-center justify-content-center" style="width:90px;height:90px;background:#f8f9fa;border:2px solid #dee2e6;">
                                <div>
                                    <div id="countPasswords" class="h3 mb-0">0</div>
                                    <small class="text-muted">Passwords</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <div class="mx-auto mb-2 rounded-circle d-flex align-items-center justify-content-center" style="width:90px;height:90px;background:#f8f9fa;border:2px solid #dee2e6;">
                                <div>
                                    <div id="countFiles" class="h3 mb-0">0</div>
                                    <small class="text-muted">Files</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <div class="mx-auto mb-2 rounded-circle d-flex align-items-center justify-content-center" style="width:90px;height:90px;background:#f8f9fa;border:2px solid #dee2e6;">
                                <div>
                                    <div id="countGpg" class="h3 mb-0">0</div>
                                    <small class="text-muted">GPG keys</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-4">
                <h5>Quick Actions</h5>
                <div class="d-flex gap-2 flex-wrap">
                    <button class="btn btn-outline-primary quick-action" data-tab="passwords"><i class="bi bi-plus-circle"></i> Add Password</button>
                    <button class="btn btn-outline-primary quick-action" data-tab="files"><i class="bi bi-upload"></i> Add File</button>
                    <button class="btn btn-outline-primary quick-action" data-tab="gpg"><i class="bi bi-key"></i> Generate GPG Key</button>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="passwords">
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th data-sort-key="label">Label</th>
                    <th data-sort-key="group_name">Group</th>
                    <th data-sort-key="address">Address</th>
                    <th data-sort-key="username">Username/E-Mail</th>
                    <th data-sort-key="password">Password</th>
                    <th data-sort-key="added_date">Added</th>
                    <th style="width: 200px;">Actions</th>
                </tr>
                </thead>
                <tbody id="passwords-body"></tbody>
            </table>
            <div class="d-flex justify-content-end mt-2">
                <button class="btn btn-primary add-btn" data-type="password">Add new</button>
            </div>

            <!-- Templates for concise JS rendering -->
            <template id="password-row-template">
                <tr>
                    <td class="cell-label"></td>
                    <td class="cell-group"></td>
                    <td class="cell-address"></td>
                    <td class="cell-username"></td>
                    <td class="cell-password">
                        <span class="password-hidden">••••••••</span>
                        <span class="password-visible" style="display: none;"></span>
                        <button class="btn btn-sm btn-link toggle-password-visibility p-0 ms-2" title="Show/Hide">
                            <i class="bi bi-eye"></i>
                        </button>
                    </td>
                    <td class="cell-added"></td>
                    <td class="cell-actions">
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-outline-info copy-password" title="Copy">
                                <i class="bi bi-clipboard"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary edit-password" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-password" title="Delete">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </template>
        </div>
        <div class="tab-pane" id="groups">
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Group name</th>
                    <th>Added</th>
                    <th style="width: 120px;">Actions</th>
                </tr>
                </thead>
                <tbody id="groups-body"></tbody>
            </table>
            <div class="d-flex justify-content-end mt-2">
                <button class="btn btn-primary" id="addGroupBtn">Add group</button>
            </div>
        </div>
        <div class="tab-pane" id="files">
            <table class="table table-bordered" id="filesTable">
                <thead>
                <tr>
                    <th data-sort-key="name">File name</th>
                    <th data-sort-key="type">Type</th>
                    <th data-sort-key="added_date">Added</th>
                    <th style="width: 120px;">Actions</th>
                </tr>
                </thead>
                <tbody id="files-body"></tbody>
            </table>
            <div class="d-flex justify-content-end mt-2">
                <button class="btn btn-primary add-btn" data-type="file">Add new</button>
            </div>
        </div>
        <div class="tab-pane" id="gpg">
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Key name</th>
                    <th>User ID</th>
                    <th>Type</th>
                    <th>Added</th>
                    <th style="width: 120px;">Actions</th>
                </tr>
                </thead>
                <tbody id="gpg-body"></tbody>
            </table>
            <div class="d-flex justify-content-end mt-2 gap-2">
                <button class="btn btn-info" id="openClipboardBtn"><i class="bi bi-clipboard-check"></i> Clipboard</button>
                <button class="btn btn-success" id="generateGpgBtn"><i class="bi bi-key"></i> Generate</button>
                <button class="btn btn-primary" id="importGpgBtn"><i class="bi bi-upload"></i> Import</button>
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Settings</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="about-tab" data-bs-toggle="tab" data-bs-target="#about" type="button" role="tab">About</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="updates-tab" data-bs-toggle="tab" data-bs-target="#updates" type="button" role="tab">Updates</button>
                    </li>
                </ul>
                <div class="tab-content mt-3" id="settingsTabContent">
                    <div class="tab-pane fade show active" id="about" role="tabpanel">
                        <div class="p-4">
                            <div class="text-center mb-6">
                                <h4 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500 mb-1">ssVault</h4>
                                <p class="text-gray-500 font-medium tracking-wide text-sm">Secure Storage Vault</p>
                            </div>
                            
                            <div class="grid grid-cols-1 gap-3 max-w-sm mx-auto">
                                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 flex justify-between items-center shadow-sm hover:shadow-md transition-shadow">
                                    <span class="text-gray-600 font-semibold text-sm">Version</span>
                                    <span id="appVersion" class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-0.5 rounded-full">Loading...</span>
                                </div>
                                
                                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 flex justify-between items-center shadow-sm hover:shadow-md transition-shadow">
                                    <span class="text-gray-600 font-semibold text-sm">Author</span>
                                    <span id="appAuthor" class="text-gray-800 font-medium text-sm">Loading...</span>
                                </div>
                                
                                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 flex justify-between items-center shadow-sm hover:shadow-md transition-shadow">
                                    <span class="text-gray-600 font-semibold text-sm">License</span>
                                    <span id="appLicense" class="text-gray-800 font-medium text-sm">Loading...</span>
                                </div>
                            </div>

                            <div class="mt-6 text-center">
                                <p class="text-[10px] text-gray-400">Built with Electron & Tailwind</p>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="updates" role="tabpanel">
                        <div class="p-4">
                            <h5 class="mb-3">Update Settings</h5>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="autoUpdateCheckbox">
                                <label class="form-check-label" for="autoUpdateCheckbox">
                                    Automatically check for updates
                                </label>
                            </div>
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary" id="checkForUpdatesBtn">
                                    <i class="bi bi-arrow-repeat"></i> Check for updates
                                </button>
                            </div>
                            <div id="updateStatusMsg" class="mt-3 text-muted small text-center"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Update Available Modal -->
<div class="modal fade" id="updateAvailableModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Available</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>A new version of ssVault is available!</p>
                <p class="text-muted small">Would you like to download and install it now?</p>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="dontAskAgainCheckbox">
                    <label class="form-check-label" for="dontAskAgainCheckbox">
                        Do not ask me again
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Later</button>
                <button type="button" class="btn btn-primary" id="downloadUpdateBtn">Download & Install</button>
            </div>
        </div>
    </div>
</div>

<!-- Add modal (generic, adapts by type) -->
<div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTitle">Add new</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addForm">
                    <input type="hidden" id="addType">
                    <input type="hidden" id="editId">
                    <div class="mb-3">
                        <label for="addName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="addName" required>
                    </div>
                    <div class="mb-3" id="addExtra"></div>  <!-- Dynamic for password/file/gpg -->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="addSubmit">Add</button>
            </div>
        </div>
    </div>
</div>

<!-- Generate GPG key pair modal -->
<div class="modal fade" id="generateGpgModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generate new GPG key pair</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="generateGpgForm">
                    <div class="mb-3">
                        <label for="gpgKeyName" class="form-label">Key pair name <small class="text-muted">(for storage in vault)</small></label>
                        <input type="text" class="form-control" id="gpgKeyName" placeholder="e.g. My Personal Key" required>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <label for="gpgUserName" class="form-label">Name <small class="text-muted">(required)</small></label>
                        <input type="text" class="form-control" id="gpgUserName" placeholder="e.g. John Doe" required>
                    </div>
                    <div class="mb-3">
                        <label for="gpgEmail" class="form-label">E-mail <small class="text-muted">(optional)</small></label>
                        <input type="email" class="form-control" id="gpgEmail" placeholder="e.g. john@example.com">
                    </div>
                    <div class="mb-3">
                        <label for="gpgExpiration" class="form-label">Expiration</label>
                        <select class="form-select" id="gpgExpiration">
                            <option value="0">Never expires</option>
                            <option value="30">30 days</option>
                            <option value="90">90 days</option>
                            <option value="180">6 months</option>
                            <option value="365">1 year</option>
                            <option value="730">2 years</option>
                            <option value="1825">5 years</option>
                        </select>
                    </div>
                </form>
                <div class="alert alert-info">
                    <small><i class="bi bi-info-circle"></i> This will generate a new RSA 4096-bit key pair and store both private and public keys in the vault.</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="generateGpgSubmit">Generate</button>
            </div>
        </div>
    </div>
</div>

<!-- Clipboard Modal -->
<div class="modal fade" id="clipboardModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-clipboard-check"></i> GPG Clipboard</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="clipboardInput" class="form-label">Text input</label>
                    <textarea class="form-control" id="clipboardInput" rows="6" placeholder="Paste or type text here..."></textarea>
                </div>
                <div class="mb-3">
                    <label for="clipboardOutput" class="form-label">Output</label>
                    <textarea class="form-control" id="clipboardOutput" rows="6" readonly placeholder="Encrypted/Decrypted text will appear here..."></textarea>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="clipboardKeySelect" class="form-label">Select key</label>
                        <select class="form-select" id="clipboardKeySelect">
                            <option value="">-- Select a key --</option>
                        </select>
                    </div>
                    <div class="col-md-6 d-flex align-items-end gap-2">
                        <button class="btn btn-primary flex-fill" id="clipboardEncryptBtn" disabled>
                            <i class="bi bi-lock"></i> Encrypt
                        </button>
                        <button class="btn btn-success flex-fill" id="clipboardDecryptBtn" disabled>
                            <i class="bi bi-unlock"></i> Decrypt
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" id="clipboardCopyBtn">
                    <i class="bi bi-clipboard"></i> Copy output
                </button>
                <button type="button" class="btn btn-outline-secondary" id="clipboardClearBtn">
                    <i class="bi bi-trash"></i> Clear
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="passwordGeneratorModal" tabindex="-1" style="z-index: 1060;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Password Generator</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Generated Password</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="generatedPassword" readonly>
                        <button class="btn btn-outline-secondary" type="button" id="copyGeneratedPassword">
                            <i class="bi bi-clipboard"></i>
                        </button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="passwordLength" class="form-label">Length: <span id="passwordLengthValue">16</span></label>
                    <input type="range" class="form-range" id="passwordLength" min="8" max="64" value="16">
                </div>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includeUppercase" checked>
                        <label class="form-check-label" for="includeUppercase">Uppercase (A-Z)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includeLowercase" checked>
                        <label class="form-check-label" for="includeLowercase">Lowercase (a-z)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includeNumbers" checked>
                        <label class="form-check-label" for="includeNumbers">Numbers (0-9)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includeSymbols" checked>
                        <label class="form-check-label" for="includeSymbols">Symbols (!@#$%^&*)</label>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Password Strength</label>
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar" id="passwordStrengthBar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <small id="passwordStrengthText" class="text-muted"></small>
                </div>
                <button class="btn btn-primary w-100" id="regeneratePassword">Regenerate</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="useGeneratedPassword">Use Password</button>
            </div>
        </div>
    </div>
</div>

<script src="../vendors/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../js/dashboard.js" type="module"></script>
</body>
</html>